<view class="page">
  <!-- 搜索栏 -->
  <search-bar 
    value="{{searchKeyword}}"
    placeholder="搜索用户、商家、活动..."
    bind:input="onSearchInput"
    bind:confirm="onSearch"
  />

  <!-- 地图容器 -->
  <view class="map-container">
    <map
      id="map"
      latitude="{{latitude}}"
      longitude="{{longitude}}"
      scale="{{mapScale}}"
      markers="{{filteredMarkers}}"
      bindregionchange="onRegionChange"
      bindmarkertap="onMarkerTap"
    ></map>
  </view>

  <!-- 地图控制按钮 -->
  <map-controls 
    bind:filter="toggleChannelPopup"
    bind:refresh="refreshLocations"
    bind:location="moveToCurrentLocation"
  />

  <!-- 频道选择器 -->
  <channel-selector 
    visible="{{showChannelPopup}}"
    currentFilter="{{currentFilter}}"
    bind:select="onFilterChange"
    bind:close="closeChannelPopup"
  />
  
  <!-- 用户信息弹窗 -->
  <user-popup 
    visible="{{showUserPopup}}"
    user="{{currentUser}}"
    bind:close="closeUserPopup"
    bind:detail="viewUserDetail"
  />
  
  <!-- 用于离屏渲染的Canvas，实际不显示 -->
  <canvas 
    id="avatarCanvas" 
    type="2d"
    style="position: absolute; left: -9999px; width: {{canvasSize}}px; height: {{canvasSize}}px;"
    canvas-id="avatarCanvas">
  </canvas>
</view> 